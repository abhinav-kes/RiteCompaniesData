<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Company Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<h2>Company ERP Usage Statistics</h2>

<canvas id="companyChart" width="400" height="200"></canvas>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    fetch('/api/company-data') // Adjust API URL if necessary
        .then(response => response.json())
        .then(data => {
            console.log("✅ API Data:", data);

            // Validate if data is an array
            if (!Array.isArray(data)) {
                console.error("❌ Error: Data is not an array", data);
                return;
            }

            // Extract ERP tool data
            const erpCount = {};
            data.forEach(company => {
                const erpTool = company.erpTool;
                if (erpTool) {
                    erpCount[erpTool] = (erpCount[erpTool] || 0) + 1;
                }
            });

            const labels = Object.keys(erpCount);
            const values = Object.values(erpCount);

            // Create Pie Chart using Chart.js
            new Chart(document.getElementById("companyChart"), {
                type: "pie",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "ERP Usage Count",
                        data: values,
                        backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4CAF50", "#9966FF"]
                    }]
                }
            });
        })
        .catch(error => console.error("❌ Error fetching data:", error));
});

</script>

</body>
</html>
